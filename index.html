<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>VR Based Education</title>
    <meta name="description" content="Web2VR">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="./assets/js/aframe.min.js"></script>
    <script src="./assets/js/quickxr.js"></script>

    <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body>
    <div id="html-container">

        <h1>VR-Based Education With STIR and TURB</h1>

        <div id="formContainer">
            <input type="text" id="videoId" placeholder="Enter Youtube Video ID" value="AKJfakEsgy0" />
            <button id="submitYoutubeId" type="button">Submit</button>
        </div>

        <span id="liveStatus">Enter the Video ID</span>

        <div id="content"></div>
    </div>

    <div id="questionPanel">
        <div id="buttonsContainer"></div>
    </div>

    <a-scene renderer="colorManagement:false;" shadow="type: pcfsoft">

    </a-scene>

    <script>

        const web2vr = new Web2VR("#html-container", {
            position: {
                x: 0,
                y: 2,
                z: -0.6
            },
        })
        web2vr.start()

        let questionPanel = new Web2VR("#questionPanel", {
            position: {
                x: 0.05,
                y: 2.1,
                z: -1.2
            },
            rotation: {
                x: 0,
                y: -45,
                z: -2
            }
        })
        questionPanel.start()


        document.getElementById("submitYoutubeId").addEventListener("click", async () => {


            let videoId = document.getElementById("videoId").value

            if (videoId) {

                document.getElementById("formContainer").innerHTML = ""

                let videoTag = document.createElement("video")
                videoTag.id = "video"
                videoTag.src = `https://relay-youtube.adaptable.app/${videoId}`
                videoTag.width = 640
                videoTag.height = 360
                videoTag.controls = true
                videoTag.crossOrigin = "anonymous"

                document.getElementById("content").appendChild(videoTag)

                document.getElementById("liveStatus").innerHTML = `Status: Generating Questions...`


                let questions = await fetch("https://youtube-questions.vercel.app", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "youtubeVideoId": videoId
                    })
                })

                questions = await questions.json()

                document.getElementById("liveStatus").innerHTML = `Status: Questions Generated`

                let questionsContainer = document.createElement("div")
                questionsContainer.id = "questionsContainer"

                let questionsDiv = document.createElement("div")
                questionsDiv.id = "questions"

                let h1Tag = document.createElement("h1")
                h1Tag.innerHTML = "Try to answer these after watching the video"
                questionsDiv.appendChild(h1Tag)

                questions.forEach((question, index) => {
                    let questionSpan = document.createElement("span")
                    questionSpan.innerHTML = question

                    let answerInput = document.createElement("input")
                    answerInput.type = "text"
                    answerInput.placeholder = "Enter Answer"
                    answerInput.dataset.id = index + 1

                    questionsDiv.appendChild(questionSpan)
                    questionsDiv.appendChild(answerInput)
                })

                questionsContainer.appendChild(questionsDiv)

                document.getElementById("questionPanel").prepend(questionsContainer)

                document.getElementById("buttonsContainer").innerHTML = `<button id="submitAnswer" type="button">Submit Answers</button>`

                document.getElementById("submitAnswer").addEventListener("click", async () => {

                    let answers = []
                    document.querySelectorAll("#questions input").forEach((input) => {
                        answers.push({
                            "questionId": input.dataset.id,
                            "answer": input.value
                        })
                    })

                    console.log(answers)

                })
            }
        })

    </script>
</body>

</html>